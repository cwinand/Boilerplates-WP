var $=jQuery,app=app||{};app.ArchiveItemView=Backbone.View.extend({className:"archive-item",template:wp.template("item-archive-template"),render:function(){return this.$el.html(this.template(this.model.attributes)),this}}),app.ArchiveView=Backbone.View.extend({className:"archive",events:{"click .archive-item a":"goToItem"},initialize:function(a){var b=this;switch(this.archiveCollection={},a.archiveRoute){case"casestudies":app.caseStudies?this.archiveCollection=app.caseStudies:(this.archiveCollection=new app.CaseStudies,app.caseStudies=this.archiveCollection);break;case"perspectives":app.perspectives?this.archiveCollection=app.perspectives:(this.archiveCollection=new app.Perspectives,app.perspectives=this.archiveCollection);break;case"news":app.news?this.archiveCollection=app.news:(this.archiveCollection=new app.NewsArticles,app.news=this.archiveCollection)}this.archiveCollection.length>0?this.render():a.archiveRoute&&this.archiveCollection.fetch({success:function(){b.render()}})},render:function(){return this.archiveCollection.each(function(a){this.renderArchiveItem(a)},this),this},renderArchiveItem:function(a){var b=new app.ArchiveItemView({model:a});this.$el.append(b.render().el)},goToItem:function(a){a.preventDefault();var b=a.target.pathname;app.router.navigate(b,{trigger:!0})}}),app.CareersFormView=Backbone.View.extend({el:"#application",initialize:function(){var a=this;this.formEl=this.$el,this.inputEls=this.formEl.children("input"),this.inputs={},_.each(a.inputEls,function(b){var c=b.getAttribute("name");a.inputs[c]=b})},events:{submit:"submitForm","keydown input":"handleKeypress","blur input":"handleBlur","click button":"uploadFile"},handleKeypress:function(a){var b=$(a.target),c=this.$el.find("label[for="+b.attr("name")+"]");9!==a.which&&(c.addClass("active").removeClass("locked"),b.addClass("processing"))},handleBlur:function(a){var b=$(a.target),c=a.target.name,d=this.$el.find("label[for="+b.attr("name")+"]");switch(c){case"fname":case"lname":case"email":""===b.val().trim()?b.attr({placeholder:"This is required","class":"negative"}):b.addClass("positive").removeClass("negative"),d.addClass("locked").removeClass("active"),b.removeClass("processing");break;case"phone":""===b.val().trim()?(d.removeClass("active"),b.removeClass()):(b.addClass("positive").removeClass("negative"),d.addClass("locked").removeClass("active")),b.removeClass("processing");break;case"portfolio":case"linkedin":case"website":case"referrer":""===b.val().trim()?(d.removeClass("active"),b.removeClass()):(b.addClass("positive").removeClass("negative"),d.addClass("locked").removeClass("active")),b.removeClass("processing");break;case"resume":}},validateFields:function(){var a=$(this.inputs.fname).val(),b=$(this.inputs.lname).val(),c=$(this.inputs.email).val();return""!==a&&""!==b&&""!==c?!0:void 0},uploadFile:function(){var a=this;$(a.inputs.resume).click(),$(a.inputs.resume).on("change",function(){a.inputs.resume.files[0].size<=1e7?$(".file-upload").css("border","2px solid lime").text(a.inputs.resume.files[0].name):(a.inputs.resume.value="",$(".file-upload").css("border","2px solid red").text("File size must be less than 10MB"))})},submitForm:function(a){a.preventDefault();var b=this;if(this.validateFields()){var c=new FormData(this.el);c.append("action","sendApplication");var d=$.ajax({url:WPAjax.ajaxurl,method:"POST",data:c,processData:!1,contentType:!1});d.done(function(a){console.log(a);var c=b.formEl.height();$(".application-container").height(c).children("h2").text("Success!"),b.formEl.remove()})}}}),app.CarouselItemView=Backbone.View.extend({template:wp.template("item-carousel-template"),initialize:function(a){this.$el.addClass("item"+a.itemNumber),a.isCopy&&this.$el.addClass("copy")},render:function(){return this.$el.html(this.template(this.model.attributes)),this}}),app.CarouselView=Backbone.View.extend({className:"carousel is-animated__slide-right",events:{"click .carousel-item a":"goToItem"},timingConfig:{slideStatic:4e3,slideTransition:750,slideTotal:4750,headlineFade:250,scrollToTop:750},initialize:function(){var a=this;this.$returnHomeAnchor=$("#return-home-anchor"),app.carouselCollection?(this.render(),app.pubSub.trigger("carouselLoaded")):(app.carouselCollection=[],$.when(app.perspectives.fetch(),app.caseStudies.fetch(),app.newsArticles.fetch(),app.postType.fetch()).done(function(){app.perspectives.each(function(a){a.set({typeLabel:app.postType.attributes.perspectives.name})}),app.newsArticles.each(function(a){a.set({typeLabel:app.postType.attributes.news.name})}),app.caseStudies.each(function(a){a.set({typeLabel:app.postType.attributes.casestudies.name})}),app.carouselCollection.push(app.perspectives.where({part_of_carousel:!0}),app.caseStudies.where({part_of_carousel:!0}),app.newsArticles.where({part_of_carousel:!0})),app.carouselCollection=_.chain(app.carouselCollection).flatten().sortBy(function(a){return a.attributes.date}).reverse().value(),a.render(),app.pubSub.trigger("carouselLoaded")})),this.$returnHomeAnchor.addClass("is-invisible"),app.pubSub.on("openingSwipeEnded",this.handleOpeningSwipeEnd,this),app.pubSub.on("pauseCarousel",this.handleCarouselPause,this),app.pubSub.on("resumeCarousel",this.handleCarouselResume,this)},render:function(){return this.$el.empty(),_.each(app.carouselCollection,function(a,b){0===b&&this.renderCarouselItem(a,b,!0),this.renderCarouselItem(a,b,!1)},this),this},renderCarouselItem:function(a,b,c){var d=new app.CarouselItemView({model:a,itemNumber:b,isCopy:c});this.$el.append(d.render().el)},goToItem:function(a){a.preventDefault();var b=a.target.pathname;app.router.navigate(b,{trigger:!0})},handleOpeningSwipeEnd:function(){var a=this;a.categories=$(".carousel-item-category"),a.titles=$(".carousel-item-title"),app.pubSub.off("openingSwipeEnded",a.handleOpeningSwipeEnd)},handleCarouselPause:function(){var a=this;app.$body.addClass("is-scrollable"),app.$html.addClass("is-scrollable"),a.$el.addClass("is-animated__pause")},handleCarouselResume:function(){var a=this;body.animate({scrollTop:0},a.timingConfig.scrollToTop),html.animate({scrollTop:0},a.timingConfig.scrollToTop),app.$body.removeClass("is-scrollable"),app.$html.removeClass("is-scrollable"),a.$el.removeClass("is-animated__pause")}}),app.ContactFormView=Backbone.View.extend({el:"#contact",initialize:function(){var a=this;this.formEl=this.$el,this.inputEls=this.formEl.children("input"),this.inputs={},_.each(a.inputEls,function(b){var c=b.getAttribute("name");a.inputs[c]=b})},events:{submit:"submitForm","keydown input":"handleKeypress","blur input":"handleBlur"},handleKeypress:function(a){var b=$(a.target),c=this.$el.find("label[for="+b.attr("name")+"]");9!==a.which&&(c.addClass("active").removeClass("locked"),b.addClass("processing"))},handleBlur:function(a){var b=$(a.target),c=a.target.name,d=this.$el.find("label[for="+b.attr("name")+"]");switch(c){case"fname":case"lname":case"email":""===b.val().trim()?b.attr({placeholder:"This is required","class":"negative"}):b.addClass("positive").removeClass("negative"),d.addClass("locked").removeClass("active"),b.removeClass("processing");break;case"phone":""===b.val().trim()?(d.removeClass("active"),b.removeClass()):(b.addClass("positive").removeClass("negative"),d.addClass("locked").removeClass("active")),b.removeClass("processing");break;case"message":}},validateFields:function(){var a=$(this.inputs.fname).val(),b=$(this.inputs.lname).val(),c=$(this.inputs.email).val();return""!==a&&""!==b&&""!==c?!0:void 0},submitForm:function(a){a.preventDefault();var b=this;if(this.validateFields()){var c=new FormData(this.el);c.append("action","sendContactForm");var d=$.ajax({url:WPAjax.ajaxurl,method:"POST",data:c,processData:!1,contentType:!1});d.done(function(a){console.log(a);var c=b.formEl.height();$(".contact-container").height(c).children("h2").text("Success!"),b.formEl.remove()})}}}),app.HamburgerView=Backbone.View.extend({events:{click:"toggleNavMenu"},initialize:function(){this.$returnHomeAnchor=$("#return-home-anchor"),app.pubSub.on("flipBurger",this.flipBurger,this)},toggleNavMenu:function(a){a.preventDefault(),app.pubSub.trigger("navToggle")},flipBurger:function(){this.$el.toggleClass("opened closed"),this.$returnHomeAnchor.toggleClass("nav-opened"),this.$returnHomeAnchor.hasClass("is-invisible")&&this.$returnHomeAnchor.toggleClass("is-invisible")}}),app.NavigationView=Backbone.View.extend({events:{"click a":"navigateToTarget"},bgColors:["#FF7E00","#00A92A","#0099E6","#7F32A6"],initialize:function(){app.pubSub.on("navToggle",this.toggleNavMenu,this)},navigateToTarget:function(a){a.preventDefault();var b=a.target.pathname,c=this;app.router.navigate(b,{trigger:!0}),c.toggleNavMenu()},toggleNavMenu:function(){var a=this;if(app.pubSub.trigger("flipBurger"),a.$el.hasClass("open"))a.$el.addClass("fade-out"),setTimeout(function(){a.$el.removeClass("open fade-out"),a.$el.removeAttr("style")},250);else{var b=a.bgColors[_.random(a.bgColors.length)];a.$el.css("background-color",b),a.$el.addClass("open")}}}),app.PageView=Backbone.View.extend({initialize:function(a){var b=this;this.pageModel=app.pages.get(a.page),this.template=wp.template("page-"+a.page+"-template"),this.pageModel?"culture"===a.page?(this.render(),$("#content").empty().html(this.$el),window.picturefill()):this.render():(this.pageModel=new app.Page({id:a.page}),app.pages.add(this.pageModel),this.pageModel.fetch({success:function(){"culture"!==a.page?("what-we-do"===a.page&&(b.pageModel.attributes.nextPost=app.caseStudies.models[0].attributes,b.pageModel.attributes.prevPost=app.caseStudies.models[1].attributes),b.render(),"careers"===a.page?app.pubSub.trigger("initCareerForm"):"contact"===a.page&&app.pubSub.trigger("initContactForm")):$.get(window.location.href).done(function(a){b.pageModel.attributes.content=$(a).find("#content").html(),$("#content").empty().html(b.pageModel.attributes.content),window.picturefill()})}}))},render:function(){return this.$el.html(this.template(this.pageModel.attributes)),this}}),app.SinglePostView=Backbone.View.extend({events:{"click .next-prev a":"navigateToTarget"},initialize:function(a){var b=this;this.viewCollection=app[a.collectionName],this.template=wp.template("single-"+a.postType+"-template"),this.postModel=this.viewCollection.get(a.page),this.postModel?(this.postModel.attributes.nextPost&&this.postModel.attributes.prevPost||b.getNextPrev(),this.render()):this.viewCollection.fetch({success:function(){b.postModel=b.viewCollection.get(a.page),b.getNextPrev(),b.render()}})},getNextPrev:function(){var a=this.viewCollection.models,b=_.indexOf(a,this.postModel);-1!==b&&(0===b?(this.postModel.attributes.nextPost=a[b+1].attributes,this.postModel.attributes.prevPost=a[a.length-1].attributes):b+1===a.length?(this.postModel.attributes.nextPost=a[0].attributes,this.postModel.attributes.prevPost=a[b-1].attributes):(this.postModel.attributes.nextPost=a[b+1].attributes,this.postModel.attributes.prevPost=a[b-1].attributes))},navigateToTarget:function(a){a.preventDefault();var b=a.target.pathname;app.router.navigate(b,{trigger:!0})},setParallax:function(){var a=$(window),b=this.$el.children(".parallax"),c=b.children(".article-title");a.on("scroll",function(){var d=a.scrollTop()/3,e="translateY("+d+"px)",f="translateY(-"+d+"px)";b.css({transform:e}),c.css({transform:f})})},render:function(){return this.$el.html(this.template(this.postModel.attributes)),this.setParallax(),this}}),app.WiperView=Backbone.View.extend({el:"#wiper",events:{animationend:"handleOpeningSwipeEnd",webkitAnimationEnd:"handleOpeningSwipeEnd"},initialize:function(){this.$wiperLogo=$(".wiper-logo"),this.$returnHomeAnchor=$("#return-home-anchor"),this.$wiperLogo.children().addClass("is-animated__fade-slide"),app.pubSub.on("carouselLoaded",this.startOpeningSwipe,this),app.pubSub.on("swipeToPage",this.handleSwipeToPage,this),app.pubSub.on("swipeToCarousel",this.handleSwipeToCarousel,this),app.pubSub.on("swipeToArticle",this.handleSwipeToArticle,this),app.pubSub.on("swipeToArchive",this.handleSwipeToArchive,this)},startOpeningSwipe:function(){this.$el.addClass("is-animated__opening-swipe"),this.$wiperLogo.addClass("is-animated__logo-slide")},handleOpeningSwipeEnd:function(a){app.pubSub.trigger("openingSwipeEnded",a.originalEvent)},handleSwipeToCarousel:function(a){if(this.$wiperLogo.removeClass("is-hidden"),a&&!_.isEmpty(app.carouselCollection))switch(this.$el.removeClass().show(),this.$el.addClass("is-animated__opening-swipe"),this.$returnHomeAnchor.addClass("is-invisible"),this.$wiperLogo.children().removeClass("fade-out").addClass("is-animated__fade-slide"),a){case"article":break;case"page":break;case"archive":}},handleSwipeToPage:function(a){if(a)switch(a){case"carousel":this.$el.removeClass().hide(),this.$returnHomeAnchor.removeClass("is-invisible"),this.$wiperLogo.children().removeClass("is-animated__fade-slide").addClass("fade-out");break;case"article":break;case"archive":}},handleSwipeToArticle:function(a){if(a)switch(a){case"carousel":this.$el.removeClass().hide(),this.$returnHomeAnchor.removeClass("is-invisible"),this.$wiperLogo.children().removeClass("is-animated__fade-slide").addClass("fade-out");break;case"page":break;case"archive":}},handleSwipeToArchive:function(a){if(a)switch(a){case"carousel":this.$el.removeClass().hide(),this.$returnHomeAnchor.removeClass("is-invisible"),this.$wiperLogo.children().removeClass("is-animated__fade-slide").addClass("fade-out");break;case"page":break;case"article":}}}),app.CaseStudy=Backbone.Model.extend({idAttribute:"slug"}),app.NewsArticle=Backbone.Model.extend({idAttribute:"slug"}),app.Page=Backbone.Model.extend({defaults:{title:"",content:""}}),app.Perspective=Backbone.Model.extend({idAttribute:"slug"}),app.Post=Backbone.Model.extend({defaults:{title:"",content:""}}),app.PostType=Backbone.Model.extend({url:"/wp-json/posts/types"}),app.postType=new app.PostType,app.CaseStudies=Backbone.Collection.extend({model:app.CaseStudy,url:"/wp-json/posts?type=casestudies"}),app.caseStudies=new app.CaseStudies,app.NewsArticles=Backbone.Collection.extend({model:app.NewsArticle,url:"/wp-json/posts?type=news"}),app.newsArticles=new app.NewsArticles,app.Pages=Backbone.Collection.extend({model:app.Page,url:"/wp-json/pages"}),app.pages=new app.Pages,app.Perspectives=Backbone.Collection.extend({model:app.Perspective,url:"/wp-json/posts?type=perspectives"}),app.perspectives=new app.Perspectives,app.Posts=Backbone.Collection.extend({model:app.Post,url:"/wp-json/posts"}),app.AppRouter=Backbone.Router.extend({routes:{"(/)":"home",":posttype/:page(/)":"getArticle","casestudies(/)":"getArchive","perspectives(/)":"getArchive","news(/)":"getArchive",":page(/)":"getPage"},home:function(){app.carouselView=app.carouselView||new app.CarouselView({previousView:app.previousView}),$("#carousel-container").html(app.carouselView.render().el),$("#content").empty(),app.$body.addClass("is-not-scrollable"),app.$body.removeClass("page post"),$(window).off("scroll"),app.pubSub.trigger("swipeToCarousel",app.previousView),app.previousView="carousel"},getPage:function(a){"what-we-do"===a&&app.caseStudies.isEmpty()?(app.caseStudies=new app.CaseStudies,app.caseStudies.fetch({success:function(){app.singlePageView=new app.PageView({page:a}),$("#content").html(app.singlePageView.el)}})):(app.singlePageView=new app.PageView({page:a}),$("#content").html(app.singlePageView.el)),$("#carousel-container").empty(),window.scrollTo(0,0),$(window).off("scroll"),app.$body.addClass("is-scrollable page"),app.$body.removeClass("post archive is-not-scrollable"),"careers"===a?app.pubSub.on("initCareerForm",function(){app.careersFormView=new app.CareersFormView}):"contact"===a&&app.pubSub.on("initContactForm",function(){app.contactFormView=new app.ContactFormView}),app.pubSub.trigger("swipeToPage",app.previousView),app.previousView="page"},getArticle:function(a,b){var c;switch(a){case"casestudies":c="caseStudies";break;case"perspectives":c="perspectives";break;case"news":c="newsArticles"}app.singlePostView=new app.SinglePostView({collectionName:c,postType:a,page:b}),$("#content").html(app.singlePostView.el),$("#carousel-container").empty(),window.scrollTo(0,0),app.$body.addClass("is-scrollable post"),app.$body.removeClass("page archive is-not-scrollable"),app.pubSub.trigger("swipeToArticle",app.previousView),app.previousView="article"},getArchive:function(){var a=document.location.pathname.split("/").reverse(),b=_.without(a,"")[0];app.archiveView=new app.ArchiveView({archiveRoute:b}),$("#content").html(app.archiveView.el),$("#carousel-container").empty(),window.scrollTo(0,0),$(window).off("scroll"),app.$body.addClass("is-scrollable archive"),app.$body.removeClass("page post is-not-scrollable"),app.pubSub.trigger("swipeToArchive",app.previousView),app.previousView="archive"}}),$(document).ready(function(){app.pubSub=_.extend({},Backbone.Events),app.$html=$("html"),app.$body=$("body"),app.mainNavigation=new app.NavigationView({el:"#site-navigation"}),app.hamburgerButton=new app.HamburgerView({el:"#hamburger-menu"}),app.wiperView=new app.WiperView,app.router=new app.AppRouter,$("#return-home-anchor").on("click",function(a){a.preventDefault();var b=a.currentTarget.pathname;app.router.navigate(b,{trigger:!0}),$(a.currentTarget).hasClass("nav-opened")&&app.pubSub.trigger("navToggle")}),Backbone.history.start({pushState:!0,hashChange:!1})});